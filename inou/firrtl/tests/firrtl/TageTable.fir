circuit TageTable :
  module TageTable : 
    input clock : Clock
    input reset : UInt<1>
    output io : {flip f1_req_valid : UInt<1>, flip f1_req_pc : UInt<40>, flip f1_req_ghist : UInt<64>, f3_resp : {valid : UInt<1>, bits : {ctr : UInt<3>, u : UInt<2>}}[4], flip update_mask : UInt<1>[4], flip update_taken : UInt<1>[4], flip update_alloc : UInt<1>[4], flip update_old_ctr : UInt<3>[4], flip update_pc : UInt, flip update_hist : UInt, flip update_u_mask : UInt<1>[4], flip update_u : UInt<2>[4]}
    
    clock is invalid
    reset is invalid
    io is invalid
    reg doing_reset : UInt<1>, clock with : (reset => (reset, UInt<1>("h01"))) @[tage.scala 72:28]
    reg reset_idx : UInt<7>, clock with : (reset => (reset, UInt<7>("h00"))) @[tage.scala 73:26]
    node _T = add(reset_idx, doing_reset) @[tage.scala 74:26]
    node _T_1 = tail(_T, 1) @[tage.scala 74:26]
    reset_idx <= _T_1 @[tage.scala 74:13]
    node _T_2 = eq(reset_idx, UInt<7>("h07f")) @[tage.scala 75:19]
    when _T_2 : @[tage.scala 75:36]
      doing_reset <= UInt<1>("h00") @[tage.scala 75:50]
      skip @[tage.scala 75:36]
    node _T_3 = shr(io.f1_req_pc, 3) @[frontend.scala 164:35]
    node _T_4 = bits(io.f1_req_ghist, 1, 0) @[tage.scala 53:11]
    node _T_5 = xor(_T_3, _T_4) @[tage.scala 60:29]
    node s1_hashed_idx = bits(_T_5, 6, 0) @[tage.scala 60:43]
    node _T_6 = bits(io.f1_req_ghist, 1, 0) @[tage.scala 53:11]
    node _T_7 = shr(_T_3, 7) @[tage.scala 62:30]
    node _T_8 = xor(_T_7, _T_6) @[tage.scala 62:50]
    node s1_tag = bits(_T_8, 6, 0) @[tage.scala 62:64]
    smem hi_us : UInt<1>[4][128], undefined @[tage.scala 89:27]
    smem lo_us : UInt<1>[4][128], undefined @[tage.scala 90:27]
    smem table : UInt<11>[4][128], undefined @[tage.scala 91:27]
    reg s2_tag : UInt, clock @[tage.scala 95:29]
    s2_tag <= s1_tag @[tage.scala 95:29]
    wire _T_9 : UInt @[tage.scala 97:40]
    _T_9 is invalid @[tage.scala 97:40]
    when io.f1_req_valid : @[tage.scala 97:40]
      _T_9 <= s1_hashed_idx @[tage.scala 97:40]
      node _T_10 = or(_T_9, UInt<7>("h00")) @[tage.scala 97:40]
      node _T_11 = bits(_T_10, 6, 0) @[tage.scala 97:40]
      read mport _T_12 = table[_T_11], clock @[tage.scala 97:40]
      skip @[tage.scala 97:40]
    wire _T_13 : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>} @[tage.scala 97:87]
    wire _T_14 : UInt<11>
    _T_14 <= _T_12[0]
    node _T_15 = bits(_T_14, 2, 0) @[tage.scala 97:87]
    _T_13.ctr <= _T_15 @[tage.scala 97:87]
    node _T_16 = bits(_T_14, 9, 3) @[tage.scala 97:87]
    _T_13.tag <= _T_16 @[tage.scala 97:87]
    node _T_17 = bits(_T_14, 10, 10) @[tage.scala 97:87]
    _T_13.valid <= _T_17 @[tage.scala 97:87]
    wire _T_18 : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>} @[tage.scala 97:87]
    wire _T_19 : UInt<11>
    _T_19 <= _T_12[1]
    node _T_20 = bits(_T_19, 2, 0) @[tage.scala 97:87]
    _T_18.ctr <= _T_20 @[tage.scala 97:87]
    node _T_21 = bits(_T_19, 9, 3) @[tage.scala 97:87]
    _T_18.tag <= _T_21 @[tage.scala 97:87]
    node _T_22 = bits(_T_19, 10, 10) @[tage.scala 97:87]
    _T_18.valid <= _T_22 @[tage.scala 97:87]
    wire _T_23 : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>} @[tage.scala 97:87]
    wire _T_24 : UInt<11>
    _T_24 <= _T_12[2]
    node _T_25 = bits(_T_24, 2, 0) @[tage.scala 97:87]
    _T_23.ctr <= _T_25 @[tage.scala 97:87]
    node _T_26 = bits(_T_24, 9, 3) @[tage.scala 97:87]
    _T_23.tag <= _T_26 @[tage.scala 97:87]
    node _T_27 = bits(_T_24, 10, 10) @[tage.scala 97:87]
    _T_23.valid <= _T_27 @[tage.scala 97:87]
    wire _T_28 : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>} @[tage.scala 97:87]
    wire _T_29 : UInt<11>
    _T_29 <= _T_12[3]
    node _T_30 = bits(_T_29, 2, 0) @[tage.scala 97:87]
    _T_28.ctr <= _T_30 @[tage.scala 97:87]
    node _T_31 = bits(_T_29, 9, 3) @[tage.scala 97:87]
    _T_28.tag <= _T_31 @[tage.scala 97:87]
    node _T_32 = bits(_T_29, 10, 10) @[tage.scala 97:87]
    _T_28.valid <= _T_32 @[tage.scala 97:87]
    wire s2_req_rtage : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>}[4] @[tage.scala 97:29]
    s2_req_rtage[0].ctr <= _T_13.ctr @[tage.scala 97:29]
    s2_req_rtage[0].tag <= _T_13.tag @[tage.scala 97:29]
    s2_req_rtage[0].valid <= _T_13.valid @[tage.scala 97:29]
    s2_req_rtage[1].ctr <= _T_18.ctr @[tage.scala 97:29]
    s2_req_rtage[1].tag <= _T_18.tag @[tage.scala 97:29]
    s2_req_rtage[1].valid <= _T_18.valid @[tage.scala 97:29]
    s2_req_rtage[2].ctr <= _T_23.ctr @[tage.scala 97:29]
    s2_req_rtage[2].tag <= _T_23.tag @[tage.scala 97:29]
    s2_req_rtage[2].valid <= _T_23.valid @[tage.scala 97:29]
    s2_req_rtage[3].ctr <= _T_28.ctr @[tage.scala 97:29]
    s2_req_rtage[3].tag <= _T_28.tag @[tage.scala 97:29]
    s2_req_rtage[3].valid <= _T_28.valid @[tage.scala 97:29]
    wire _T_33 : UInt @[tage.scala 98:32]
    _T_33 is invalid @[tage.scala 98:32]
    when io.f1_req_valid : @[tage.scala 98:32]
      _T_33 <= s1_hashed_idx @[tage.scala 98:32]
      node _T_34 = or(_T_33, UInt<7>("h00")) @[tage.scala 98:32]
      node _T_35 = bits(_T_34, 6, 0) @[tage.scala 98:32]
      read mport s2_req_rhius = hi_us[_T_35], clock @[tage.scala 98:32]
      skip @[tage.scala 98:32]
    wire _T_36 : UInt @[tage.scala 99:32]
    _T_36 is invalid @[tage.scala 99:32]
    when io.f1_req_valid : @[tage.scala 99:32]
      _T_36 <= s1_hashed_idx @[tage.scala 99:32]
      node _T_37 = or(_T_36, UInt<7>("h00")) @[tage.scala 99:32]
      node _T_38 = bits(_T_37, 6, 0) @[tage.scala 99:32]
      read mport s2_req_rlous = lo_us[_T_38], clock @[tage.scala 99:32]
      skip @[tage.scala 99:32]
    node _T_39 = eq(s2_req_rtage[0].tag, s2_tag) @[tage.scala 100:69]
    node _T_40 = and(s2_req_rtage[0].valid, _T_39) @[tage.scala 100:60]
    node _T_41 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 100:83]
    node _T_42 = and(_T_40, _T_41) @[tage.scala 100:80]
    node _T_43 = eq(s2_req_rtage[1].tag, s2_tag) @[tage.scala 100:69]
    node _T_44 = and(s2_req_rtage[1].valid, _T_43) @[tage.scala 100:60]
    node _T_45 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 100:83]
    node _T_46 = and(_T_44, _T_45) @[tage.scala 100:80]
    node _T_47 = eq(s2_req_rtage[2].tag, s2_tag) @[tage.scala 100:69]
    node _T_48 = and(s2_req_rtage[2].valid, _T_47) @[tage.scala 100:60]
    node _T_49 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 100:83]
    node _T_50 = and(_T_48, _T_49) @[tage.scala 100:80]
    node _T_51 = eq(s2_req_rtage[3].tag, s2_tag) @[tage.scala 100:69]
    node _T_52 = and(s2_req_rtage[3].valid, _T_51) @[tage.scala 100:60]
    node _T_53 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 100:83]
    node _T_54 = and(_T_52, _T_53) @[tage.scala 100:80]
    wire s2_req_rhits : UInt<1>[4] @[tage.scala 100:29]
    s2_req_rhits[0] <= _T_42 @[tage.scala 100:29]
    s2_req_rhits[1] <= _T_46 @[tage.scala 100:29]
    s2_req_rhits[2] <= _T_50 @[tage.scala 100:29]
    s2_req_rhits[3] <= _T_54 @[tage.scala 100:29]
    reg _T_55 : UInt<1>, clock @[tage.scala 104:38]
    _T_55 <= s2_req_rhits[0] @[tage.scala 104:38]
    io.f3_resp[0].valid <= _T_55 @[tage.scala 104:28]
    node _T_56 = cat(s2_req_rhius[0], s2_req_rlous[0]) @[Cat.scala 29:58]
    reg _T_57 : UInt, clock @[tage.scala 105:38]
    _T_57 <= _T_56 @[tage.scala 105:38]
    io.f3_resp[0].bits.u <= _T_57 @[tage.scala 105:28]
    reg _T_58 : UInt, clock @[tage.scala 106:38]
    _T_58 <= s2_req_rtage[0].ctr @[tage.scala 106:38]
    io.f3_resp[0].bits.ctr <= _T_58 @[tage.scala 106:28]
    reg _T_59 : UInt<1>, clock @[tage.scala 104:38]
    _T_59 <= s2_req_rhits[1] @[tage.scala 104:38]
    io.f3_resp[1].valid <= _T_59 @[tage.scala 104:28]
    node _T_60 = cat(s2_req_rhius[1], s2_req_rlous[1]) @[Cat.scala 29:58]
    reg _T_61 : UInt, clock @[tage.scala 105:38]
    _T_61 <= _T_60 @[tage.scala 105:38]
    io.f3_resp[1].bits.u <= _T_61 @[tage.scala 105:28]
    reg _T_62 : UInt, clock @[tage.scala 106:38]
    _T_62 <= s2_req_rtage[1].ctr @[tage.scala 106:38]
    io.f3_resp[1].bits.ctr <= _T_62 @[tage.scala 106:28]
    reg _T_63 : UInt<1>, clock @[tage.scala 104:38]
    _T_63 <= s2_req_rhits[2] @[tage.scala 104:38]
    io.f3_resp[2].valid <= _T_63 @[tage.scala 104:28]
    node _T_64 = cat(s2_req_rhius[2], s2_req_rlous[2]) @[Cat.scala 29:58]
    reg _T_65 : UInt, clock @[tage.scala 105:38]
    _T_65 <= _T_64 @[tage.scala 105:38]
    io.f3_resp[2].bits.u <= _T_65 @[tage.scala 105:28]
    reg _T_66 : UInt, clock @[tage.scala 106:38]
    _T_66 <= s2_req_rtage[2].ctr @[tage.scala 106:38]
    io.f3_resp[2].bits.ctr <= _T_66 @[tage.scala 106:28]
    reg _T_67 : UInt<1>, clock @[tage.scala 104:38]
    _T_67 <= s2_req_rhits[3] @[tage.scala 104:38]
    io.f3_resp[3].valid <= _T_67 @[tage.scala 104:28]
    node _T_68 = cat(s2_req_rhius[3], s2_req_rlous[3]) @[Cat.scala 29:58]
    reg _T_69 : UInt, clock @[tage.scala 105:38]
    _T_69 <= _T_68 @[tage.scala 105:38]
    io.f3_resp[3].bits.u <= _T_69 @[tage.scala 105:28]
    reg _T_70 : UInt, clock @[tage.scala 106:38]
    _T_70 <= s2_req_rtage[3].ctr @[tage.scala 106:38]
    io.f3_resp[3].bits.ctr <= _T_70 @[tage.scala 106:28]
    reg clear_u_ctr : UInt<19>, clock with : (reset => (reset, UInt<19>("h00"))) @[tage.scala 109:28]
    when doing_reset : @[tage.scala 110:22]
      clear_u_ctr <= UInt<1>("h01") @[tage.scala 110:36]
      skip @[tage.scala 110:22]
    else : @[tage.scala 110:56]
      node _T_71 = add(clear_u_ctr, UInt<1>("h01")) @[tage.scala 110:85]
      node _T_72 = tail(_T_71, 1) @[tage.scala 110:85]
      clear_u_ctr <= _T_72 @[tage.scala 110:70]
      skip @[tage.scala 110:56]
    node _T_73 = bits(clear_u_ctr, 10, 0) @[tage.scala 112:34]
    node doing_clear_u = eq(_T_73, UInt<1>("h00")) @[tage.scala 112:61]
    node _T_74 = bits(clear_u_ctr, 18, 18) @[tage.scala 113:54]
    node _T_75 = eq(_T_74, UInt<1>("h01")) @[tage.scala 113:95]
    node doing_clear_u_hi = and(doing_clear_u, _T_75) @[tage.scala 113:40]
    node _T_76 = bits(clear_u_ctr, 18, 18) @[tage.scala 114:54]
    node _T_77 = eq(_T_76, UInt<1>("h00")) @[tage.scala 114:95]
    node doing_clear_u_lo = and(doing_clear_u, _T_77) @[tage.scala 114:40]
    node clear_u_idx = shr(clear_u_ctr, 11) @[tage.scala 115:33]
    node _T_78 = shr(io.update_pc, 3) @[frontend.scala 164:35]
    node _T_79 = bits(io.update_hist, 1, 0) @[tage.scala 53:11]
    node _T_80 = xor(_T_78, _T_79) @[tage.scala 60:29]
    node update_idx = bits(_T_80, 6, 0) @[tage.scala 60:43]
    node _T_81 = bits(io.update_hist, 1, 0) @[tage.scala 53:11]
    node _T_82 = shr(_T_78, 7) @[tage.scala 62:30]
    node _T_83 = xor(_T_82, _T_81) @[tage.scala 62:50]
    node update_tag = bits(_T_83, 6, 0) @[tage.scala 62:64]
    wire update_wdata : {valid : UInt<1>, tag : UInt<7>, ctr : UInt<3>}[4] @[tage.scala 119:26]
    node _T_84 = mux(doing_reset, reset_idx, update_idx) @[tage.scala 122:8]
    wire _T_85 : UInt<11>[4] @[tage.scala 123:29]
    _T_85[0] <= UInt<11>("h00") @[tage.scala 123:29]
    _T_85[1] <= UInt<11>("h00") @[tage.scala 123:29]
    _T_85[2] <= UInt<11>("h00") @[tage.scala 123:29]
    _T_85[3] <= UInt<11>("h00") @[tage.scala 123:29]
    node _T_86 = cat(update_wdata[0].valid, update_wdata[0].tag) @[tage.scala 123:102]
    node _T_87 = cat(_T_86, update_wdata[0].ctr) @[tage.scala 123:102]
    node _T_88 = cat(update_wdata[1].valid, update_wdata[1].tag) @[tage.scala 123:102]
    node _T_89 = cat(_T_88, update_wdata[1].ctr) @[tage.scala 123:102]
    node _T_90 = cat(update_wdata[2].valid, update_wdata[2].tag) @[tage.scala 123:102]
    node _T_91 = cat(_T_90, update_wdata[2].ctr) @[tage.scala 123:102]
    node _T_92 = cat(update_wdata[3].valid, update_wdata[3].tag) @[tage.scala 123:102]
    node _T_93 = cat(_T_92, update_wdata[3].ctr) @[tage.scala 123:102]
    wire _T_94 : UInt<11>[4] @[tage.scala 123:82]
    _T_94[0] <= _T_87 @[tage.scala 123:82]
    _T_94[1] <= _T_89 @[tage.scala 123:82]
    _T_94[2] <= _T_91 @[tage.scala 123:82]
    _T_94[3] <= _T_93 @[tage.scala 123:82]
    node _T_95 = mux(doing_reset, _T_85, _T_94) @[tage.scala 123:8]
    node _T_96 = not(UInt<4>("h00")) @[tage.scala 124:22]
    node _T_97 = cat(io.update_mask[1], io.update_mask[0]) @[tage.scala 124:90]
    node _T_98 = cat(io.update_mask[3], io.update_mask[2]) @[tage.scala 124:90]
    node _T_99 = cat(_T_98, _T_97) @[tage.scala 124:90]
    node _T_100 = mux(doing_reset, _T_96, _T_99) @[tage.scala 124:8]
    node _T_101 = bits(_T_100, 0, 0) @[tage.scala 124:98]
    node _T_102 = bits(_T_100, 1, 1) @[tage.scala 124:98]
    node _T_103 = bits(_T_100, 2, 2) @[tage.scala 124:98]
    node _T_104 = bits(_T_100, 3, 3) @[tage.scala 124:98]
    write mport _T_105 = table[_T_84], clock
    when _T_101 :
      _T_105[0] <= _T_95[0]
      skip
    when _T_102 :
      _T_105[1] <= _T_95[1]
      skip
    when _T_103 :
      _T_105[2] <= _T_95[2]
      skip
    when _T_104 :
      _T_105[3] <= _T_95[3]
      skip
    wire update_hi_wdata : UInt<1>[4] @[tage.scala 127:29]
    node _T_106 = mux(doing_clear_u_hi, clear_u_idx, update_idx) @[tage.scala 129:36]
    node _T_107 = mux(doing_reset, reset_idx, _T_106) @[tage.scala 129:8]
    node _T_108 = or(doing_reset, doing_clear_u_hi) @[tage.scala 130:21]
    wire _T_109 : UInt<1>[4] @[tage.scala 130:49]
    _T_109[0] <= UInt<1>("h00") @[tage.scala 130:49]
    _T_109[1] <= UInt<1>("h00") @[tage.scala 130:49]
    _T_109[2] <= UInt<1>("h00") @[tage.scala 130:49]
    _T_109[3] <= UInt<1>("h00") @[tage.scala 130:49]
    node _T_110 = mux(_T_108, _T_109, update_hi_wdata) @[tage.scala 130:8]
    node _T_111 = or(doing_reset, doing_clear_u_hi) @[tage.scala 131:21]
    node _T_112 = not(UInt<4>("h00")) @[tage.scala 131:42]
    node _T_113 = cat(io.update_u_mask[1], io.update_u_mask[0]) @[tage.scala 131:80]
    node _T_114 = cat(io.update_u_mask[3], io.update_u_mask[2]) @[tage.scala 131:80]
    node _T_115 = cat(_T_114, _T_113) @[tage.scala 131:80]
    node _T_116 = mux(_T_111, _T_112, _T_115) @[tage.scala 131:8]
    node _T_117 = bits(_T_116, 0, 0) @[tage.scala 131:88]
    node _T_118 = bits(_T_116, 1, 1) @[tage.scala 131:88]
    node _T_119 = bits(_T_116, 2, 2) @[tage.scala 131:88]
    node _T_120 = bits(_T_116, 3, 3) @[tage.scala 131:88]
    node _T_121 = bits(_T_107, 6, 0)
    write mport _T_122 = hi_us[_T_121], clock
    when _T_117 :
      _T_122[0] <= _T_110[0]
      skip
    when _T_118 :
      _T_122[1] <= _T_110[1]
      skip
    when _T_119 :
      _T_122[2] <= _T_110[2]
      skip
    when _T_120 :
      _T_122[3] <= _T_110[3]
      skip
    wire update_lo_wdata : UInt<1>[4] @[tage.scala 134:29]
    node _T_123 = mux(doing_clear_u_lo, clear_u_idx, update_idx) @[tage.scala 136:36]
    node _T_124 = mux(doing_reset, reset_idx, _T_123) @[tage.scala 136:8]
    node _T_125 = or(doing_reset, doing_clear_u_lo) @[tage.scala 137:21]
    wire _T_126 : UInt<1>[4] @[tage.scala 137:49]
    _T_126[0] <= UInt<1>("h00") @[tage.scala 137:49]
    _T_126[1] <= UInt<1>("h00") @[tage.scala 137:49]
    _T_126[2] <= UInt<1>("h00") @[tage.scala 137:49]
    _T_126[3] <= UInt<1>("h00") @[tage.scala 137:49]
    node _T_127 = mux(_T_125, _T_126, update_lo_wdata) @[tage.scala 137:8]
    node _T_128 = or(doing_reset, doing_clear_u_lo) @[tage.scala 138:21]
    node _T_129 = not(UInt<4>("h00")) @[tage.scala 138:42]
    node _T_130 = cat(io.update_u_mask[1], io.update_u_mask[0]) @[tage.scala 138:80]
    node _T_131 = cat(io.update_u_mask[3], io.update_u_mask[2]) @[tage.scala 138:80]
    node _T_132 = cat(_T_131, _T_130) @[tage.scala 138:80]
    node _T_133 = mux(_T_128, _T_129, _T_132) @[tage.scala 138:8]
    node _T_134 = bits(_T_133, 0, 0) @[tage.scala 138:88]
    node _T_135 = bits(_T_133, 1, 1) @[tage.scala 138:88]
    node _T_136 = bits(_T_133, 2, 2) @[tage.scala 138:88]
    node _T_137 = bits(_T_133, 3, 3) @[tage.scala 138:88]
    node _T_138 = bits(_T_124, 6, 0)
    write mport _T_139 = lo_us[_T_138], clock
    when _T_134 :
      _T_139[0] <= _T_127[0]
      skip
    when _T_135 :
      _T_139[1] <= _T_127[1]
      skip
    when _T_136 :
      _T_139[2] <= _T_127[2]
      skip
    when _T_137 :
      _T_139[3] <= _T_127[3]
      skip
    reg wrbypass_tags : UInt<7>[2], clock @[tage.scala 141:29]
    reg wrbypass_idxs : UInt<7>[2], clock @[tage.scala 142:29]
    reg wrbypass : UInt<3>[4][2], clock @[tage.scala 143:29]
    reg wrbypass_enq_idx : UInt<1>, clock with : (reset => (reset, UInt<1>("h00"))) @[tage.scala 144:33]
    node _T_140 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 147:5]
    node _T_141 = eq(wrbypass_tags[0], update_tag) @[tage.scala 148:22]
    node _T_142 = and(_T_140, _T_141) @[tage.scala 147:18]
    node _T_143 = eq(wrbypass_idxs[0], update_idx) @[tage.scala 149:22]
    node _T_144 = and(_T_142, _T_143) @[tage.scala 148:37]
    node _T_145 = eq(doing_reset, UInt<1>("h00")) @[tage.scala 147:5]
    node _T_146 = eq(wrbypass_tags[1], update_tag) @[tage.scala 148:22]
    node _T_147 = and(_T_145, _T_146) @[tage.scala 147:18]
    node _T_148 = eq(wrbypass_idxs[1], update_idx) @[tage.scala 149:22]
    node _T_149 = and(_T_147, _T_148) @[tage.scala 148:37]
    wire wrbypass_hits : UInt<1>[2] @[tage.scala 146:33]
    wrbypass_hits[0] <= _T_144 @[tage.scala 146:33]
    wrbypass_hits[1] <= _T_149 @[tage.scala 146:33]
    node wrbypass_hit = or(wrbypass_hits[0], wrbypass_hits[1]) @[tage.scala 151:48]
    node wrbypass_hit_idx = mux(wrbypass_hits[0], UInt<1>("h00"), UInt<1>("h01")) @[Mux.scala 47:69]
    node _T_150 = mux(io.update_taken[0], UInt<3>("h04"), UInt<2>("h03")) @[tage.scala 156:10]
    node _T_151 = eq(io.update_taken[0], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_152 = eq(wrbypass[wrbypass_hit_idx][0], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_153 = sub(wrbypass[wrbypass_hit_idx][0], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_154 = tail(_T_153, 1) @[tage.scala 67:43]
    node _T_155 = mux(_T_152, UInt<1>("h00"), _T_154) @[tage.scala 67:20]
    node _T_156 = eq(wrbypass[wrbypass_hit_idx][0], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_157 = add(wrbypass[wrbypass_hit_idx][0], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_158 = tail(_T_157, 1) @[tage.scala 68:43]
    node _T_159 = mux(_T_156, UInt<3>("h07"), _T_158) @[tage.scala 68:20]
    node _T_160 = mux(_T_151, _T_155, _T_159) @[tage.scala 67:8]
    node _T_161 = eq(io.update_taken[0], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_162 = eq(io.update_old_ctr[0], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_163 = sub(io.update_old_ctr[0], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_164 = tail(_T_163, 1) @[tage.scala 67:43]
    node _T_165 = mux(_T_162, UInt<1>("h00"), _T_164) @[tage.scala 67:20]
    node _T_166 = eq(io.update_old_ctr[0], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_167 = add(io.update_old_ctr[0], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_168 = tail(_T_167, 1) @[tage.scala 68:43]
    node _T_169 = mux(_T_166, UInt<3>("h07"), _T_168) @[tage.scala 68:20]
    node _T_170 = mux(_T_161, _T_165, _T_169) @[tage.scala 67:8]
    node _T_171 = mux(wrbypass_hit, _T_160, _T_170) @[tage.scala 159:10]
    node _T_172 = mux(io.update_alloc[0], _T_150, _T_171) @[tage.scala 155:33]
    update_wdata[0].ctr <= _T_172 @[tage.scala 155:27]
    update_wdata[0].valid <= UInt<1>("h01") @[tage.scala 163:27]
    update_wdata[0].tag <= update_tag @[tage.scala 164:27]
    node _T_173 = bits(io.update_u[0], 1, 1) @[tage.scala 166:44]
    update_hi_wdata[0] <= _T_173 @[tage.scala 166:27]
    node _T_174 = bits(io.update_u[0], 0, 0) @[tage.scala 167:44]
    update_lo_wdata[0] <= _T_174 @[tage.scala 167:27]
    node _T_175 = mux(io.update_taken[1], UInt<3>("h04"), UInt<2>("h03")) @[tage.scala 156:10]
    node _T_176 = eq(io.update_taken[1], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_177 = eq(wrbypass[wrbypass_hit_idx][1], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_178 = sub(wrbypass[wrbypass_hit_idx][1], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_179 = tail(_T_178, 1) @[tage.scala 67:43]
    node _T_180 = mux(_T_177, UInt<1>("h00"), _T_179) @[tage.scala 67:20]
    node _T_181 = eq(wrbypass[wrbypass_hit_idx][1], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_182 = add(wrbypass[wrbypass_hit_idx][1], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_183 = tail(_T_182, 1) @[tage.scala 68:43]
    node _T_184 = mux(_T_181, UInt<3>("h07"), _T_183) @[tage.scala 68:20]
    node _T_185 = mux(_T_176, _T_180, _T_184) @[tage.scala 67:8]
    node _T_186 = eq(io.update_taken[1], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_187 = eq(io.update_old_ctr[1], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_188 = sub(io.update_old_ctr[1], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_189 = tail(_T_188, 1) @[tage.scala 67:43]
    node _T_190 = mux(_T_187, UInt<1>("h00"), _T_189) @[tage.scala 67:20]
    node _T_191 = eq(io.update_old_ctr[1], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_192 = add(io.update_old_ctr[1], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_193 = tail(_T_192, 1) @[tage.scala 68:43]
    node _T_194 = mux(_T_191, UInt<3>("h07"), _T_193) @[tage.scala 68:20]
    node _T_195 = mux(_T_186, _T_190, _T_194) @[tage.scala 67:8]
    node _T_196 = mux(wrbypass_hit, _T_185, _T_195) @[tage.scala 159:10]
    node _T_197 = mux(io.update_alloc[1], _T_175, _T_196) @[tage.scala 155:33]
    update_wdata[1].ctr <= _T_197 @[tage.scala 155:27]
    update_wdata[1].valid <= UInt<1>("h01") @[tage.scala 163:27]
    update_wdata[1].tag <= update_tag @[tage.scala 164:27]
    node _T_198 = bits(io.update_u[1], 1, 1) @[tage.scala 166:44]
    update_hi_wdata[1] <= _T_198 @[tage.scala 166:27]
    node _T_199 = bits(io.update_u[1], 0, 0) @[tage.scala 167:44]
    update_lo_wdata[1] <= _T_199 @[tage.scala 167:27]
    node _T_200 = mux(io.update_taken[2], UInt<3>("h04"), UInt<2>("h03")) @[tage.scala 156:10]
    node _T_201 = eq(io.update_taken[2], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_202 = eq(wrbypass[wrbypass_hit_idx][2], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_203 = sub(wrbypass[wrbypass_hit_idx][2], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_204 = tail(_T_203, 1) @[tage.scala 67:43]
    node _T_205 = mux(_T_202, UInt<1>("h00"), _T_204) @[tage.scala 67:20]
    node _T_206 = eq(wrbypass[wrbypass_hit_idx][2], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_207 = add(wrbypass[wrbypass_hit_idx][2], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_208 = tail(_T_207, 1) @[tage.scala 68:43]
    node _T_209 = mux(_T_206, UInt<3>("h07"), _T_208) @[tage.scala 68:20]
    node _T_210 = mux(_T_201, _T_205, _T_209) @[tage.scala 67:8]
    node _T_211 = eq(io.update_taken[2], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_212 = eq(io.update_old_ctr[2], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_213 = sub(io.update_old_ctr[2], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_214 = tail(_T_213, 1) @[tage.scala 67:43]
    node _T_215 = mux(_T_212, UInt<1>("h00"), _T_214) @[tage.scala 67:20]
    node _T_216 = eq(io.update_old_ctr[2], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_217 = add(io.update_old_ctr[2], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_218 = tail(_T_217, 1) @[tage.scala 68:43]
    node _T_219 = mux(_T_216, UInt<3>("h07"), _T_218) @[tage.scala 68:20]
    node _T_220 = mux(_T_211, _T_215, _T_219) @[tage.scala 67:8]
    node _T_221 = mux(wrbypass_hit, _T_210, _T_220) @[tage.scala 159:10]
    node _T_222 = mux(io.update_alloc[2], _T_200, _T_221) @[tage.scala 155:33]
    update_wdata[2].ctr <= _T_222 @[tage.scala 155:27]
    update_wdata[2].valid <= UInt<1>("h01") @[tage.scala 163:27]
    update_wdata[2].tag <= update_tag @[tage.scala 164:27]
    node _T_223 = bits(io.update_u[2], 1, 1) @[tage.scala 166:44]
    update_hi_wdata[2] <= _T_223 @[tage.scala 166:27]
    node _T_224 = bits(io.update_u[2], 0, 0) @[tage.scala 167:44]
    update_lo_wdata[2] <= _T_224 @[tage.scala 167:27]
    node _T_225 = mux(io.update_taken[3], UInt<3>("h04"), UInt<2>("h03")) @[tage.scala 156:10]
    node _T_226 = eq(io.update_taken[3], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_227 = eq(wrbypass[wrbypass_hit_idx][3], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_228 = sub(wrbypass[wrbypass_hit_idx][3], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_229 = tail(_T_228, 1) @[tage.scala 67:43]
    node _T_230 = mux(_T_227, UInt<1>("h00"), _T_229) @[tage.scala 67:20]
    node _T_231 = eq(wrbypass[wrbypass_hit_idx][3], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_232 = add(wrbypass[wrbypass_hit_idx][3], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_233 = tail(_T_232, 1) @[tage.scala 68:43]
    node _T_234 = mux(_T_231, UInt<3>("h07"), _T_233) @[tage.scala 68:20]
    node _T_235 = mux(_T_226, _T_230, _T_234) @[tage.scala 67:8]
    node _T_236 = eq(io.update_taken[3], UInt<1>("h00")) @[tage.scala 67:9]
    node _T_237 = eq(io.update_old_ctr[3], UInt<1>("h00")) @[tage.scala 67:25]
    node _T_238 = sub(io.update_old_ctr[3], UInt<1>("h01")) @[tage.scala 67:43]
    node _T_239 = tail(_T_238, 1) @[tage.scala 67:43]
    node _T_240 = mux(_T_237, UInt<1>("h00"), _T_239) @[tage.scala 67:20]
    node _T_241 = eq(io.update_old_ctr[3], UInt<3>("h07")) @[tage.scala 68:25]
    node _T_242 = add(io.update_old_ctr[3], UInt<1>("h01")) @[tage.scala 68:43]
    node _T_243 = tail(_T_242, 1) @[tage.scala 68:43]
    node _T_244 = mux(_T_241, UInt<3>("h07"), _T_243) @[tage.scala 68:20]
    node _T_245 = mux(_T_236, _T_240, _T_244) @[tage.scala 67:8]
    node _T_246 = mux(wrbypass_hit, _T_235, _T_245) @[tage.scala 159:10]
    node _T_247 = mux(io.update_alloc[3], _T_225, _T_246) @[tage.scala 155:33]
    update_wdata[3].ctr <= _T_247 @[tage.scala 155:27]
    update_wdata[3].valid <= UInt<1>("h01") @[tage.scala 163:27]
    update_wdata[3].tag <= update_tag @[tage.scala 164:27]
    node _T_248 = bits(io.update_u[3], 1, 1) @[tage.scala 166:44]
    update_hi_wdata[3] <= _T_248 @[tage.scala 166:27]
    node _T_249 = bits(io.update_u[3], 0, 0) @[tage.scala 167:44]
    update_lo_wdata[3] <= _T_249 @[tage.scala 167:27]
    node _T_250 = or(io.update_mask[0], io.update_mask[1]) @[tage.scala 170:32]
    node _T_251 = or(_T_250, io.update_mask[2]) @[tage.scala 170:32]
    node _T_252 = or(_T_251, io.update_mask[3]) @[tage.scala 170:32]
    when _T_252 : @[tage.scala 170:38]
      node _T_253 = or(wrbypass_hits[0], wrbypass_hits[1]) @[tage.scala 171:33]
      when _T_253 : @[tage.scala 171:39]
        wire _T_254 : UInt<3>[4] @[tage.scala 172:44]
        _T_254[0] <= update_wdata[0].ctr @[tage.scala 172:44]
        _T_254[1] <= update_wdata[1].ctr @[tage.scala 172:44]
        _T_254[2] <= update_wdata[2].ctr @[tage.scala 172:44]
        _T_254[3] <= update_wdata[3].ctr @[tage.scala 172:44]
        wrbypass[wrbypass_hit_idx][0] <= _T_254[0] @[tage.scala 172:34]
        wrbypass[wrbypass_hit_idx][1] <= _T_254[1] @[tage.scala 172:34]
        wrbypass[wrbypass_hit_idx][2] <= _T_254[2] @[tage.scala 172:34]
        wrbypass[wrbypass_hit_idx][3] <= _T_254[3] @[tage.scala 172:34]
        skip @[tage.scala 171:39]
      else : @[tage.scala 173:18]
        wire _T_255 : UInt<3>[4] @[tage.scala 174:49]
        _T_255[0] <= update_wdata[0].ctr @[tage.scala 174:49]
        _T_255[1] <= update_wdata[1].ctr @[tage.scala 174:49]
        _T_255[2] <= update_wdata[2].ctr @[tage.scala 174:49]
        _T_255[3] <= update_wdata[3].ctr @[tage.scala 174:49]
        wrbypass[wrbypass_enq_idx][0] <= _T_255[0] @[tage.scala 174:39]
        wrbypass[wrbypass_enq_idx][1] <= _T_255[1] @[tage.scala 174:39]
        wrbypass[wrbypass_enq_idx][2] <= _T_255[2] @[tage.scala 174:39]
        wrbypass[wrbypass_enq_idx][3] <= _T_255[3] @[tage.scala 174:39]
        wrbypass_tags[wrbypass_enq_idx] <= update_tag @[tage.scala 175:39]
        wrbypass_idxs[wrbypass_enq_idx] <= update_idx @[tage.scala 176:39]
        node _T_256 = add(wrbypass_enq_idx, UInt<1>("h01")) @[util.scala 203:14]
        node _T_257 = tail(_T_256, 1) @[util.scala 203:14]
        node _T_258 = bits(_T_257, 0, 0) @[util.scala 203:20]
        wrbypass_enq_idx <= _T_258 @[tage.scala 177:24]
        skip @[tage.scala 173:18]
      skip @[tage.scala 170:38]
    
